Profiling

From Jay

If you run boogie with /proc:<mangled name> and /z3opt:TRACE=true
it will generate z3.log
Z3AxiomProfiler.exe

dafny tttree.dfy /proc:'CheckWellformed$$_6_TwoThreeTree.__default.tempLemma' /print:/tmp/foo

jonh@howell-thinkpad:~/dafny-base/boogie/Binaries$ ln -s ../../dafny/Binaries/z3.exe .

Getting profiler working depends on getting boogie working depends on
referencing the ELF z3, not the z3.exe (Windows binary).

mono ~/dafny-base/boogie/Binaries/Boogie.exe /z3exe:/home/jonh/dafny-base/dafny/Binaries/z3/bin/z3 /proc:'Impl$$_6_TwoThreeTree.__default.InsertIntoThreeNodeRight' /tmp/foo.bpl /z3opt:TRACE=true

Wow, that took a long time!

sudo apt install mercurial
hg clone https://bitbucket.org/viperproject/axiom-profiler
cd axiom-profiler/
mono ../boogie/nuget.exe install Microsoft.Net.Compilers
xbuild /p:Configuration=Release source/AxiomProfiler.sln
mono ../dafny-base/axiom-profiler/bin/Release/AxiomProfiler.exe z3.log

Tragically, it throws an exception on my logfile.

Trying again with https://github.com/Nils-Becker/z3.git
per https://bitbucket.org/viperproject/axiom-profiler/issues/2/exception-expected-pattern-but-found-term

mono ~/dafny-base/boogie/Binaries/Boogie.exe /z3exe:/home/jonh/dafny-base/nils-z3/z3/build/z3 /proc:'Impl$$_6_TwoThreeTree.__default.InsertIntoThreeNodeRight' /tmp/foo.bpl /z3opt:TRACE=true /z3opt:PROOF=true

test1: original z3
test2: new z3, no PROOF=true
test3: new z3, PROOF=true


Wish list:

A compiler flag to check for non-opaque recursive, existential, and set/map
comprehension function definitions.

Bug report:
cf51b15 dafny ttbenchmark fails verifying something in an upstream file,
    which feels bonkers.

------------------------------------------------------------------------------
Try #2 February 24, 2019

dafny /print:test.boogie ImmutableDiskTreeRefinement.dfy
ImmutableDiskTreeRefinement.dfy(139,6): Verification inconclusive (Impl$$_53_ImmutableDiskTreeRefinement.__default.OneDatumPerKeyInvInduction)

grep OneDatumPerKeyInvInduction test.bpl

mono ~/dafny-base/boogie/Binaries/Boogie.exe  /z3exe:/home/jonh/dafny-base/dafny/Binaries/z3/bin/z3  /proc:'Impl$$_53_ImmutableDiskTreeRefinement.__default.OneDatumPerKeyInvInduction' test.bpl /z3opt:TRACE=true

I hit ^C when z3.log got to 500MB.

mono ~/dafny-base/axiom-profiler/bin/Release/AxiomProfiler.exe  z3.log
(top says mono is chewing hard) Wow that took like 5 minutes.
...but everything is zero.

Next steps:
1. grep on the z3.log?
2. try it in Windows?
